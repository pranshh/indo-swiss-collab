<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results - Research Publications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
            :root {
        --swiss-red: #ff0000;
        --indian-orange: #FF9933;
        --indian-green: #138808;
        --navy: #1B1B3A;
    }

    .navbar {
        background: linear-gradient(45deg, var(--swiss-red), var(--indian-orange)) !important;
    }

    .table th { 
        background-color: #f8f9fa;
        border-bottom: 2px solid var(--swiss-red);
    }

    .btn-success {
        background-color: var(--indian-green);
        border-color: var(--indian-green);
    }

    .btn-outline-primary {
        color: var(--swiss-red);
        border-color: var(--swiss-red);
    }

    .btn-outline-primary:hover {
        background-color: var(--swiss-red);
        border-color: var(--swiss-red);
    }

    .badge.bg-primary {
        background-color: var(--swiss-red) !important;
    }

    .table tr:hover {
        background-color: rgba(255, 0, 0, 0.05) !important;
    }

    .doi-link {
        color: var(--swiss-red);
    }

    /* Add Swiss-inspired cross pattern in background */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            linear-gradient(90deg, transparent calc(50% - 1px), #f0f0f0 50%, transparent calc(50% + 1px)),
            linear-gradient(transparent calc(50% - 1px), #f0f0f0 50%, transparent calc(50% + 1px));
        z-index: -1;
        opacity: 0.4;
    }

    .table-container {
        position: relative;
        overflow: hidden;
    }

    .table-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, 
            var(--swiss-red) 33%, 
            white 33%, white 66%, 
            var(--indian-orange) 66%);
    }
        .table th { background-color: #f8f9fa; }
        .card { border: none; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        .btn-back { text-decoration: none; }
        .table td { vertical-align: middle; }
        .doi-link { color: #0d6efd; text-decoration: none; }
        .doi-link:hover { text-decoration: underline; }
        .table-container { border-radius: 8px; overflow: hidden; }
        .table tr { transition: all 0.2s ease; }
    .table tr:hover { background-color: rgba(13,110,253,0.05) !important; }
    .expandable { cursor: pointer; position: relative; }
    .expandable::after { 
        content: 'üîç';
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        transition: opacity 0.2s;
    }
    .expandable:hover::after { opacity: 1; }
    .modal-body { max-height: 80vh; overflow-y: auto; }
    .highlight { background-color: yellow; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-search-plus me-2"></i>Research Publications Database
            </span>
        </div>
    </nav>

    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="mb-0">
                <i class="fas fa-list me-2"></i>Search Results
            </h3>
            <a href="/" class="btn btn-outline-primary">
                <i class="fas fa-search me-2"></i>New Search
            </a>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-inline">
                <input type="text" id="tableSearch" class="form-control form-control-sm" placeholder="Filter results...">
            </div>
            <span class="badge bg-primary" id="resultCount"></span>
        </div>        
        {% if results %}
        <div class="card table-container">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th><i class="fas fa-heading me-2"></i>Title</th>
                            <th><i class="fas fa-file-alt me-2"></i>Abstract </th>
                            <th><i class="fas fa-university me-2"></i>Affiliations</th>
                            <th><i class="fas fa-users me-2"></i>Authors</th>
                            <th><i class="fas fa-fingerprint me-2"></i>DOI</th>
                            <th><i class="fas fa-tags me-2"></i>WoS Categories</th>
                            <th><i class="fas fa-chart-pie me-2"></i>Research Areas</th>
                            <th><i class="fas fa-calendar me-2"></i>Year</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in results %}
                        <tr>
                            <td>{{ row['article title'] | truncate(100, True, '...') }}</td>
                            <td>{{ row['abstract.s'] | truncate(100, True, '...') }}</td>
                            <td>{{ row['affiliations'] | truncate(100, True, '...') }}</td>
                            <td>{{ row['author full names'] | truncate(100, True, '...') }}</td>
                            <td>
                                {% if row['doi'] %}
                                <a href="https://doi.org/{{ row['doi'] }}" class="doi-link" target="_blank">
                                    {{ row['doi'] }}
                                </a>
                                {% endif %}
                            </td>
                            <td>{{ row['wos categories'] }}</td>
                            <td>{{ row['wos research areas'] }}</td>
                            <td>{{ row['year'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-between align-items-center">
            <form action="/download" method="post" class="d-inline">
                {% for key, value in request.form.items() %}
                <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-download me-2"></i>Download Results
                </button>
            </form>
        </div>
        {% else %}
        <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>No results found.
        </div>
        {% endif %}
    </div>
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detailed View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Table search functionality
            const searchInput = document.getElementById('tableSearch');
            const tableRows = document.querySelectorAll('tbody tr');
            const resultCount = document.getElementById('resultCount');
            
            function updateResultCount() {
                const visibleRows = document.querySelectorAll('tbody tr:not(.d-none)').length;
                resultCount.textContent = `Showing ${visibleRows} results`;
            }
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                
                tableRows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.classList.remove('d-none');
                    } else {
                        row.classList.add('d-none');
                    }
                });
                
                updateResultCount();
            });
            
            // Modal functionality for expandable cells
            const detailModal = document.getElementById('detailModal');
            const modalBody = detailModal.querySelector('.modal-body');
            
            document.querySelectorAll('.expandable').forEach(cell => {
                cell.addEventListener('click', function() {
                    const fullContent = this.getAttribute('data-title');
                    modalBody.innerHTML = `<p class="lead">${fullContent}</p>`;
                });
            });
            
            // Initialize result count
            updateResultCount();
        });
    </script>
</body>
</html>